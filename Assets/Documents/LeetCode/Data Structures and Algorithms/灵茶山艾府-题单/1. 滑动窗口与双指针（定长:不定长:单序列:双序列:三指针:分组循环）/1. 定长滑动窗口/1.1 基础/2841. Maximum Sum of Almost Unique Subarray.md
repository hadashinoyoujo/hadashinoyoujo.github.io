# 2841. Maximum Sum of Almost Unique Subarray

```c++
class Solution {
public:
    long long maxSum(std::vector<int>& nums, int m, int k) {
        int n = nums.size(), count = 0;
        long long sum = 0, max = 0;
        std::map<long long, int> map;
        for(int i = 0, j = k - 1; j < n; ++i, ++j) {
            if(i == 0) {
                for(; i <= k - 1; ++i) {
                    sum += nums[i];

                    if(map.find(nums[i]) == map.end()) {
                        map[nums[i]] = 1;
                        ++count;
                    }
                    else {
                        ++map[nums[i]];
                    }
                }
                
                if(count >= m) {
                    max = std::max(max, sum);
                }
                i = 0;
            }
            else {
                sum = sum - nums[i - 1] + nums[j];

                --map[nums[i - 1]];
                if(map[nums[i - 1]] == 0) {
                    map.erase(nums[i - 1]);
                    --count;
                }

                if(map.find(nums[j]) == map.end()) {
                    map[nums[j]] = 1;
                    ++count;
                }
                else {
                    ++map[nums[j]];
                }

                if(count >= m) {
                    max = std::max(max, sum);
                }
            }
        }
        return max;
    }
};
```

Beats 9.45%